"use strict";(self.webpackChunkcall_app_frontend=self.webpackChunkcall_app_frontend||[]).push([[386],{3386:(Be,A,c)=>{c.r(A),c.d(A,{HomeModule:()=>Ee});var R=c(5787),d=c(9808),v=c(5861),f=c(1314),u=c(7429),e=c(4893),U=c(508),S=c(226),_=c(7579),H=c(9770),Y=c(9646),C=c(9300),M=c(5698),Q=c(8675),O=c(925),l=c(1777),b=c(3589),Z=c(1159),J=c(6360);function N(i,o){}class y{constructor(){this.role="dialog",this.panelClass="",this.hasBackdrop=!0,this.backdropClass="",this.disableClose=!1,this.width="",this.height="",this.maxWidth="80vw",this.data=null,this.ariaDescribedBy=null,this.ariaLabelledBy=null,this.ariaLabel=null,this.autoFocus="first-tabbable",this.restoreFocus=!0,this.delayFocusTrap=!0,this.closeOnNavigation=!0}}const z={dialogContainer:(0,l.X$)("dialogContainer",[(0,l.SB)("void, exit",(0,l.oB)({opacity:0,transform:"scale(0.7)"})),(0,l.SB)("enter",(0,l.oB)({transform:"none"})),(0,l.eR)("* => enter",(0,l.ru)([(0,l.jt)("150ms cubic-bezier(0, 0, 0.2, 1)",(0,l.oB)({transform:"none",opacity:1})),(0,l.IO)("@*",(0,l.pV)(),{optional:!0})])),(0,l.eR)("* => void, * => exit",(0,l.ru)([(0,l.jt)("75ms cubic-bezier(0.4, 0.0, 0.2, 1)",(0,l.oB)({opacity:0})),(0,l.IO)("@*",(0,l.pV)(),{optional:!0})]))])};let W=(()=>{class i extends u.en{constructor(t,n,a,s,r,g,m,p){super(),this._elementRef=t,this._focusTrapFactory=n,this._changeDetectorRef=a,this._config=r,this._interactivityChecker=g,this._ngZone=m,this._focusMonitor=p,this._animationStateChanged=new e.vpe,this._elementFocusedBeforeDialogWasOpened=null,this._closeInteractionType=null,this.attachDomPortal=k=>(this._portalOutlet.hasAttached(),this._portalOutlet.attachDomPortal(k)),this._ariaLabelledBy=r.ariaLabelledBy||null,this._document=s}_initializeWithAttachedContent(){this._focusTrap=this._focusTrapFactory.create(this._elementRef.nativeElement),this._document&&(this._elementFocusedBeforeDialogWasOpened=(0,O.ht)())}attachComponentPortal(t){return this._portalOutlet.hasAttached(),this._portalOutlet.attachComponentPortal(t)}attachTemplatePortal(t){return this._portalOutlet.hasAttached(),this._portalOutlet.attachTemplatePortal(t)}_recaptureFocus(){this._containsFocus()||this._trapFocus()}_forceFocus(t,n){this._interactivityChecker.isFocusable(t)||(t.tabIndex=-1,this._ngZone.runOutsideAngular(()=>{const a=()=>{t.removeEventListener("blur",a),t.removeEventListener("mousedown",a),t.removeAttribute("tabindex")};t.addEventListener("blur",a),t.addEventListener("mousedown",a)})),t.focus(n)}_focusByCssSelector(t,n){let a=this._elementRef.nativeElement.querySelector(t);a&&this._forceFocus(a,n)}_trapFocus(){const t=this._elementRef.nativeElement;switch(this._config.autoFocus){case!1:case"dialog":this._containsFocus()||t.focus();break;case!0:case"first-tabbable":this._focusTrap.focusInitialElementWhenReady().then(n=>{n||this._focusDialogContainer()});break;case"first-heading":this._focusByCssSelector('h1, h2, h3, h4, h5, h6, [role="heading"]');break;default:this._focusByCssSelector(this._config.autoFocus)}}_restoreFocus(){const t=this._elementFocusedBeforeDialogWasOpened;if(this._config.restoreFocus&&t&&"function"==typeof t.focus){const n=(0,O.ht)(),a=this._elementRef.nativeElement;(!n||n===this._document.body||n===a||a.contains(n))&&(this._focusMonitor?(this._focusMonitor.focusVia(t,this._closeInteractionType),this._closeInteractionType=null):t.focus())}this._focusTrap&&this._focusTrap.destroy()}_focusDialogContainer(){this._elementRef.nativeElement.focus&&this._elementRef.nativeElement.focus()}_containsFocus(){const t=this._elementRef.nativeElement,n=(0,O.ht)();return t===n||t.contains(n)}}return i.\u0275fac=function(t){return new(t||i)(e.Y36(e.SBq),e.Y36(b.qV),e.Y36(e.sBO),e.Y36(d.K0,8),e.Y36(y),e.Y36(b.ic),e.Y36(e.R0b),e.Y36(b.tE))},i.\u0275dir=e.lG2({type:i,viewQuery:function(t,n){if(1&t&&e.Gf(u.Pl,7),2&t){let a;e.iGM(a=e.CRH())&&(n._portalOutlet=a.first)}},features:[e.qOj]}),i})(),G=(()=>{class i extends W{constructor(){super(...arguments),this._state="enter"}_onAnimationDone({toState:t,totalTime:n}){"enter"===t?(this._config.delayFocusTrap&&this._trapFocus(),this._animationStateChanged.next({state:"opened",totalTime:n})):"exit"===t&&(this._restoreFocus(),this._animationStateChanged.next({state:"closed",totalTime:n}))}_onAnimationStart({toState:t,totalTime:n}){"enter"===t?this._animationStateChanged.next({state:"opening",totalTime:n}):("exit"===t||"void"===t)&&this._animationStateChanged.next({state:"closing",totalTime:n})}_startExitAnimation(){this._state="exit",this._changeDetectorRef.markForCheck()}_initializeWithAttachedContent(){super._initializeWithAttachedContent(),this._config.delayFocusTrap||this._trapFocus()}}return i.\u0275fac=function(){let o;return function(n){return(o||(o=e.n5z(i)))(n||i)}}(),i.\u0275cmp=e.Xpm({type:i,selectors:[["mat-dialog-container"]],hostAttrs:["tabindex","-1","aria-modal","true",1,"mat-dialog-container"],hostVars:6,hostBindings:function(t,n){1&t&&e.WFA("@dialogContainer.start",function(s){return n._onAnimationStart(s)})("@dialogContainer.done",function(s){return n._onAnimationDone(s)}),2&t&&(e.Ikx("id",n._id),e.uIk("role",n._config.role)("aria-labelledby",n._config.ariaLabel?null:n._ariaLabelledBy)("aria-label",n._config.ariaLabel)("aria-describedby",n._config.ariaDescribedBy||null),e.d8E("@dialogContainer",n._state))},features:[e.qOj],decls:1,vars:0,consts:[["cdkPortalOutlet",""]],template:function(t,n){1&t&&e.YNc(0,N,0,0,"ng-template",0)},directives:[u.Pl],styles:[".mat-dialog-container{display:block;padding:24px;border-radius:4px;box-sizing:border-box;overflow:auto;outline:0;width:100%;height:100%;min-height:inherit;max-height:inherit}.cdk-high-contrast-active .mat-dialog-container{outline:solid 1px}.mat-dialog-content{display:block;margin:0 -24px;padding:0 24px;max-height:65vh;overflow:auto;-webkit-overflow-scrolling:touch}.mat-dialog-title{margin:0 0 20px;display:block}.mat-dialog-actions{padding:8px 0;display:flex;flex-wrap:wrap;min-height:52px;align-items:center;box-sizing:content-box;margin-bottom:-24px}.mat-dialog-actions[align=end]{justify-content:flex-end}.mat-dialog-actions[align=center]{justify-content:center}.mat-dialog-actions .mat-button-base+.mat-button-base,.mat-dialog-actions .mat-mdc-button-base+.mat-mdc-button-base{margin-left:8px}[dir=rtl] .mat-dialog-actions .mat-button-base+.mat-button-base,[dir=rtl] .mat-dialog-actions .mat-mdc-button-base+.mat-mdc-button-base{margin-left:0;margin-right:8px}\n"],encapsulation:2,data:{animation:[z.dialogContainer]}}),i})(),q=0;class I{constructor(o,t,n="mat-dialog-"+q++){this._overlayRef=o,this._containerInstance=t,this.id=n,this.disableClose=this._containerInstance._config.disableClose,this._afterOpened=new _.x,this._afterClosed=new _.x,this._beforeClosed=new _.x,this._state=0,t._id=n,t._animationStateChanged.pipe((0,C.h)(a=>"opened"===a.state),(0,M.q)(1)).subscribe(()=>{this._afterOpened.next(),this._afterOpened.complete()}),t._animationStateChanged.pipe((0,C.h)(a=>"closed"===a.state),(0,M.q)(1)).subscribe(()=>{clearTimeout(this._closeFallbackTimeout),this._finishDialogClose()}),o.detachments().subscribe(()=>{this._beforeClosed.next(this._result),this._beforeClosed.complete(),this._afterClosed.next(this._result),this._afterClosed.complete(),this.componentInstance=null,this._overlayRef.dispose()}),o.keydownEvents().pipe((0,C.h)(a=>a.keyCode===Z.hY&&!this.disableClose&&!(0,Z.Vb)(a))).subscribe(a=>{a.preventDefault(),F(this,"keyboard")}),o.backdropClick().subscribe(()=>{this.disableClose?this._containerInstance._recaptureFocus():F(this,"mouse")})}close(o){this._result=o,this._containerInstance._animationStateChanged.pipe((0,C.h)(t=>"closing"===t.state),(0,M.q)(1)).subscribe(t=>{this._beforeClosed.next(o),this._beforeClosed.complete(),this._overlayRef.detachBackdrop(),this._closeFallbackTimeout=setTimeout(()=>this._finishDialogClose(),t.totalTime+100)}),this._state=1,this._containerInstance._startExitAnimation()}afterOpened(){return this._afterOpened}afterClosed(){return this._afterClosed}beforeClosed(){return this._beforeClosed}backdropClick(){return this._overlayRef.backdropClick()}keydownEvents(){return this._overlayRef.keydownEvents()}updatePosition(o){let t=this._getPositionStrategy();return o&&(o.left||o.right)?o.left?t.left(o.left):t.right(o.right):t.centerHorizontally(),o&&(o.top||o.bottom)?o.top?t.top(o.top):t.bottom(o.bottom):t.centerVertically(),this._overlayRef.updatePosition(),this}updateSize(o="",t=""){return this._overlayRef.updateSize({width:o,height:t}),this._overlayRef.updatePosition(),this}addPanelClass(o){return this._overlayRef.addPanelClass(o),this}removePanelClass(o){return this._overlayRef.removePanelClass(o),this}getState(){return this._state}_finishDialogClose(){this._state=2,this._overlayRef.dispose()}_getPositionStrategy(){return this._overlayRef.getConfig().positionStrategy}}function F(i,o,t){return void 0!==i._containerInstance&&(i._containerInstance._closeInteractionType=o),i.close(t)}const j=new e.OlP("MatDialogData"),$=new e.OlP("mat-dialog-default-options"),E=new e.OlP("mat-dialog-scroll-strategy"),K={provide:E,deps:[f.aV],useFactory:function X(i){return()=>i.scrollStrategies.block()}};let ee=(()=>{class i{constructor(t,n,a,s,r,g,m,p,k,We){this._overlay=t,this._injector=n,this._defaultOptions=a,this._parentDialog=s,this._overlayContainer=r,this._dialogRefConstructor=m,this._dialogContainerType=p,this._dialogDataToken=k,this._openDialogsAtThisLevel=[],this._afterAllClosedAtThisLevel=new _.x,this._afterOpenedAtThisLevel=new _.x,this._ariaHiddenElements=new Map,this.afterAllClosed=(0,H.P)(()=>this.openDialogs.length?this._getAfterAllClosed():this._getAfterAllClosed().pipe((0,Q.O)(void 0))),this._scrollStrategy=g}get openDialogs(){return this._parentDialog?this._parentDialog.openDialogs:this._openDialogsAtThisLevel}get afterOpened(){return this._parentDialog?this._parentDialog.afterOpened:this._afterOpenedAtThisLevel}_getAfterAllClosed(){const t=this._parentDialog;return t?t._getAfterAllClosed():this._afterAllClosedAtThisLevel}open(t,n){n=function te(i,o){return Object.assign(Object.assign({},o),i)}(n,this._defaultOptions||new y),n.id&&this.getDialogById(n.id);const a=this._createOverlay(n),s=this._attachDialogContainer(a,n),r=this._attachDialogContent(t,s,a,n);return this.openDialogs.length||this._hideNonDialogContentFromAssistiveTechnology(),this.openDialogs.push(r),r.afterClosed().subscribe(()=>this._removeOpenDialog(r)),this.afterOpened.next(r),s._initializeWithAttachedContent(),r}closeAll(){this._closeDialogs(this.openDialogs)}getDialogById(t){return this.openDialogs.find(n=>n.id===t)}ngOnDestroy(){this._closeDialogs(this._openDialogsAtThisLevel),this._afterAllClosedAtThisLevel.complete(),this._afterOpenedAtThisLevel.complete()}_createOverlay(t){const n=this._getOverlayConfig(t);return this._overlay.create(n)}_getOverlayConfig(t){const n=new f.X_({positionStrategy:this._overlay.position().global(),scrollStrategy:t.scrollStrategy||this._scrollStrategy(),panelClass:t.panelClass,hasBackdrop:t.hasBackdrop,direction:t.direction,minWidth:t.minWidth,minHeight:t.minHeight,maxWidth:t.maxWidth,maxHeight:t.maxHeight,disposeOnNavigation:t.closeOnNavigation});return t.backdropClass&&(n.backdropClass=t.backdropClass),n}_attachDialogContainer(t,n){const s=e.zs3.create({parent:n&&n.viewContainerRef&&n.viewContainerRef.injector||this._injector,providers:[{provide:y,useValue:n}]}),r=new u.C5(this._dialogContainerType,n.viewContainerRef,s,n.componentFactoryResolver);return t.attach(r).instance}_attachDialogContent(t,n,a,s){const r=new this._dialogRefConstructor(a,n,s.id);if(t instanceof e.Rgc)n.attachTemplatePortal(new u.UE(t,null,{$implicit:s.data,dialogRef:r}));else{const g=this._createInjector(s,r,n),m=n.attachComponentPortal(new u.C5(t,s.viewContainerRef,g,s.componentFactoryResolver));r.componentInstance=m.instance}return r.updateSize(s.width,s.height).updatePosition(s.position),r}_createInjector(t,n,a){const s=t&&t.viewContainerRef&&t.viewContainerRef.injector,r=[{provide:this._dialogContainerType,useValue:a},{provide:this._dialogDataToken,useValue:t.data},{provide:this._dialogRefConstructor,useValue:n}];return t.direction&&(!s||!s.get(S.Is,null,e.XFs.Optional))&&r.push({provide:S.Is,useValue:{value:t.direction,change:(0,Y.of)()}}),e.zs3.create({parent:s||this._injector,providers:r})}_removeOpenDialog(t){const n=this.openDialogs.indexOf(t);n>-1&&(this.openDialogs.splice(n,1),this.openDialogs.length||(this._ariaHiddenElements.forEach((a,s)=>{a?s.setAttribute("aria-hidden",a):s.removeAttribute("aria-hidden")}),this._ariaHiddenElements.clear(),this._getAfterAllClosed().next()))}_hideNonDialogContentFromAssistiveTechnology(){const t=this._overlayContainer.getContainerElement();if(t.parentElement){const n=t.parentElement.children;for(let a=n.length-1;a>-1;a--){let s=n[a];s!==t&&"SCRIPT"!==s.nodeName&&"STYLE"!==s.nodeName&&!s.hasAttribute("aria-live")&&(this._ariaHiddenElements.set(s,s.getAttribute("aria-hidden")),s.setAttribute("aria-hidden","true"))}}}_closeDialogs(t){let n=t.length;for(;n--;)t[n].close()}}return i.\u0275fac=function(t){e.$Z()},i.\u0275dir=e.lG2({type:i}),i})(),P=(()=>{class i extends ee{constructor(t,n,a,s,r,g,m,p){super(t,n,s,g,m,r,I,G,j,p)}}return i.\u0275fac=function(t){return new(t||i)(e.LFG(f.aV),e.LFG(e.zs3),e.LFG(d.Ye,8),e.LFG($,8),e.LFG(E),e.LFG(i,12),e.LFG(f.Xj),e.LFG(J.Qb,8))},i.\u0275prov=e.Yz7({token:i,factory:i.\u0275fac}),i})(),B=(()=>{class i{}return i.\u0275fac=function(t){return new(t||i)},i.\u0275mod=e.oAB({type:i}),i.\u0275inj=e.cJS({providers:[P,K],imports:[[f.U8,u.eL,U.BQ],U.BQ]}),i})();var D=c(2313),x=c(5716);const ne=["userVideoRef"],ie=["peerVideoRef"];function oe(i,o){if(1&i&&(e.ynx(0),e.TgZ(1,"div")(2,"div",4),e._UZ(3,"img",5),e.qZA(),e.TgZ(4,"div",6)(5,"span"),e._uU(6),e.qZA()()(),e.BQk()),2&i){const t=e.oxw(2);e.xp6(3),e.Q6J("src",t.sanitizer.bypassSecurityTrustResourceUrl(null==t.callerDetails?null:t.callerDetails.profileImage),e.LSH),e.xp6(3),e.Oqu(null==t.callerDetails?null:t.callerDetails.username)}}function ae(i,o){if(1&i&&(e.ynx(0),e.TgZ(1,"div")(2,"div",4),e._UZ(3,"img",5),e.qZA(),e.TgZ(4,"div",6)(5,"span"),e._uU(6),e.qZA()()(),e.BQk()),2&i){const t=e.oxw(2);e.xp6(3),e.Q6J("src",t.sanitizer.bypassSecurityTrustResourceUrl(null==t.receiverDetails?null:t.receiverDetails.profileImage),e.LSH),e.xp6(3),e.Oqu(null==t.receiverDetails?null:t.receiverDetails.username)}}function se(i,o){if(1&i&&(e.ynx(0),e.YNc(1,oe,7,2,"ng-container",2),e.YNc(2,ae,7,2,"ng-container",2),e.BQk()),2&i){const t=e.oxw();e.xp6(1),e.Q6J("ngIf",t.isReceiver),e.xp6(1),e.Q6J("ngIf",t.isCaller)}}function re(i,o){1&i&&(e.ynx(0),e.TgZ(1,"div",7)(2,"div",1),e._UZ(3,"video",8,9),e.qZA(),e.TgZ(5,"div",1),e._UZ(6,"video",null,10),e.qZA()(),e.BQk())}function ce(i,o){1&i&&(e.ynx(0),e._UZ(1,"i",12),e.BQk())}function le(i,o){1&i&&(e.ynx(0),e._UZ(1,"i",13),e.BQk())}function de(i,o){1&i&&(e.ynx(0),e._UZ(1,"i",14),e.BQk())}function ge(i,o){1&i&&(e.ynx(0),e._UZ(1,"i",15),e.BQk())}function ue(i,o){if(1&i){const t=e.EpF();e.ynx(0),e.TgZ(1,"div",11),e.NdJ("click",function(){return e.CHM(t),e.oxw().muteAudio()}),e.YNc(2,ce,2,0,"ng-container",2),e.YNc(3,le,2,0,"ng-container",2),e.qZA(),e.TgZ(4,"div",11),e.NdJ("click",function(){return e.CHM(t),e.oxw().hideVideo()}),e.YNc(5,de,2,0,"ng-container",2),e.YNc(6,ge,2,0,"ng-container",2),e.qZA(),e.BQk()}if(2&i){const t=e.oxw();e.xp6(2),e.Q6J("ngIf",!t.miceIsMute),e.xp6(1),e.Q6J("ngIf",t.miceIsMute),e.xp6(2),e.Q6J("ngIf",!t.videoIsHide),e.xp6(1),e.Q6J("ngIf",t.videoIsHide)}}function he(i,o){if(1&i){const t=e.EpF();e.TgZ(0,"div",20),e.NdJ("click",function(){return e.CHM(t),e.oxw(2).receiverPickupCall()}),e.TgZ(1,"div",21),e._UZ(2,"i",19),e.qZA()()}}function me(i,o){if(1&i){const t=e.EpF();e.ynx(0),e.YNc(1,he,3,0,"div",16),e.TgZ(2,"div",17),e.NdJ("click",function(){return e.CHM(t),e.oxw().receiverCutCall()}),e.TgZ(3,"div",18),e._UZ(4,"i",19),e.qZA()(),e.BQk()}if(2&i){const t=e.oxw();e.xp6(1),e.Q6J("ngIf",!t.isReceiverPickupCalled)}}function fe(i,o){if(1&i){const t=e.EpF();e.ynx(0),e.TgZ(1,"div",17),e.NdJ("click",function(){return e.CHM(t),e.oxw().callerCutCall()}),e.TgZ(2,"div",18),e._UZ(3,"i",19),e.qZA()(),e.BQk()}}let T=(()=>{class i{constructor(t,n,a,s){this.sanitizer=t,this.socketService=n,this.dialogRef=a,this.data=s,this.isReceiverPickupCalled=!1,this.getUserMediaNotSupport=!1,this.videoIsHide=!1,this.miceIsMute=!1,this.iceServers={iceServers:[{urls:"stun:stun.services.mozilla.com"},{urls:"stun:stun.l.google.com:19302"}]}}ngOnInit(){this.data&&(this.isCaller=this.data.isCaller,this.callerDetails=this.data.callerDetails,this.isReceiver=this.data.isReceiver,this.receiverDetails=this.data.receiverDetails)}ngAfterViewInit(){this.isCaller&&this.isReceiverPickupTheCallListen(),this.listenCandidateEvent()}getPeerMedia(t){const n=this.peerVideo.nativeElement;n.srcObject=t,n.play()}getUserMedia(){navigator.mediaDevices&&navigator.mediaDevices.getUserMedia?navigator.mediaDevices.getUserMedia({audio:!0,video:!0}).then(t=>{const n=this.userVideo.nativeElement;n.srcObject=t,this.videoStream=t,n.play(),this.setupConnection()}).catch(t=>{console.log("Error accessing webcam:",t)}):(this.getUserMediaNotSupport=!0,console.error("getUserMedia is not supported in this browser"))}getReceiverMedia(){navigator.mediaDevices&&navigator.mediaDevices.getUserMedia?navigator.mediaDevices.getUserMedia({audio:!0,video:!0}).then(t=>{const n=this.userVideo.nativeElement;n.srcObject=t,this.videoStream=t,n.play(),this.setupConnection(),this.listenOfferEvent()}).catch(t=>{console.log("Error accessing webcam:",t)}):(this.getUserMediaNotSupport=!0,console.error("getUserMedia is not supported in this browser"))}callerCutCall(){this.socketService.emit("callendFromCaller",{callend:!0,fromUser:this.callerDetails,toUser:this.receiverDetails}),this.dialogRef.close()}cancelVideoStream(){this.videoStream&&(this.videoStream.getTracks().forEach(t=>t.stop()),this.userVideo.nativeElement.srcObject=null)}receiverCutCall(){this.socketService.emit("callendFromReceiver",{callend:!0,fromUser:this.receiverDetails,toUser:this.callerDetails}),this.dialogRef.close()}receiverPickupCall(){this.isReceiverPickupCalled=!0,this.socketService.emit("receiverPickUpCall",{fromUser:this.receiverDetails,toUser:this.callerDetails}),this.getReceiverMedia()}isReceiverPickupTheCallListen(){var t=this;this.socketService.listen("receiverPickUpCallEmit").subscribe(function(){var n=(0,v.Z)(function*(a){t.isReceiverPickupCalled=!0,t.getUserMedia()});return function(a){return n.apply(this,arguments)}}())}setupConnection(){var t=this;return(0,v.Z)(function*(){var n,a;t.rtcPeerConnection=new RTCPeerConnection(t.iceServers),t.rtcPeerConnection.onicecandidate=s=>{s.candidate&&t.socketService.emit("candidate",{candidate:s.candidate,fromUser:t.isCaller?t.callerDetails:t.receiverDetails,toUser:t.isCaller?t.receiverDetails:t.callerDetails})},t.rtcPeerConnection.ontrack=s=>{const r=t.peerVideo.nativeElement;r.srcObject=s.streams[0],r.onloadedmetadata=g=>{r.play()}},t.rtcPeerConnection.addTrack(null===(n=t.videoStream.getTracks())||void 0===n?void 0:n[0],t.videoStream),t.rtcPeerConnection.addTrack(null===(a=t.videoStream.getTracks())||void 0===a?void 0:a[1],t.videoStream),t.isCaller&&t.createRTCofferFun(),t.listenAnswerEvent()})()}createRTCofferFun(){var t=this;return(0,v.Z)(function*(){t.rtcPeerConnection.createOffer().then(n=>{t.rtcPeerConnection.setLocalDescription(n),t.socketService.emit("offer",{fromUser:t.callerDetails,toUser:t.receiverDetails,offer:n})}).catch(n=>{console.log(n)})})()}createRTCanswerFun(t){this.rtcPeerConnection.setRemoteDescription(t),this.rtcPeerConnection.createAnswer().then(n=>{this.rtcPeerConnection.setLocalDescription(n),this.socketService.emit("answer",{fromUser:this.receiverDetails,toUser:this.callerDetails,answer:n})}).catch(n=>{console.log(n)})}listenCandidateEvent(){this.socketService.listen("candidate").subscribe(t=>{let n=new RTCIceCandidate(t);this.rtcPeerConnection.addIceCandidate(n)})}listenOfferEvent(){this.socketService.listen("offer").subscribe(t=>{this.createRTCanswerFun(t)})}listenAnswerEvent(){this.socketService.listen("answer").subscribe(t=>{this.rtcPeerConnection.setRemoteDescription(t)})}muteAudio(){this.miceIsMute=!this.miceIsMute,this.videoStream&&(this.videoStream.getTracks()[0].enabled=!this.miceIsMute)}hideVideo(){this.videoIsHide=!this.videoIsHide,this.videoStream&&(this.videoStream.getTracks()[1].enabled=!this.videoIsHide)}ngOnDestroy(){this.cancelVideoStream()}}return i.\u0275fac=function(t){return new(t||i)(e.Y36(D.H7),e.Y36(x.$),e.Y36(I),e.Y36(j))},i.\u0275cmp=e.Xpm({type:i,selectors:[["app-video"]],viewQuery:function(t,n){if(1&t&&(e.Gf(ne,5),e.Gf(ie,5)),2&t){let a;e.iGM(a=e.CRH())&&(n.userVideo=a.first),e.iGM(a=e.CRH())&&(n.peerVideo=a.first)}},decls:8,vars:5,consts:[[1,"video-main-container"],[1,"d-flex","align-items-center","justify-content-center"],[4,"ngIf"],[1,"call-actions","d-flex","justify-content-evenly","align-items-center"],[1,"avatar"],["alt","",3,"src"],[1,"d-flex","justify-content-center","mt-1","h4"],[1,"d-flex","justify-content-center","align-items-center"],["muted","muted"],["userVideoRef",""],["peerVideoRef",""],[1,"border","rounded-circle","p-2","font-x-large",3,"click"],[1,"bi","bi-mic"],[1,"bi","bi-mic-mute"],[1,"bi","bi-camera-video"],[1,"bi","bi-camera-video-off"],["class","border border-success rounded-circle p-2 bg-success",3,"click",4,"ngIf"],[1,"border","border-danger","rounded-circle","p-2","bg-danger",3,"click"],[1,"hang-up","font-x-large"],[1,"bi","bi-telephone","text-white"],[1,"border","border-success","rounded-circle","p-2","bg-success",3,"click"],[1,"font-x-large"]],template:function(t,n){1&t&&(e.TgZ(0,"div",0)(1,"div",1),e.YNc(2,se,3,2,"ng-container",2),e.YNc(3,re,8,0,"ng-container",2),e.qZA(),e.TgZ(4,"div",3),e.YNc(5,ue,7,4,"ng-container",2),e.YNc(6,me,5,1,"ng-container",2),e.YNc(7,fe,4,0,"ng-container",2),e.qZA()()),2&t&&(e.xp6(2),e.Q6J("ngIf",!n.isReceiverPickupCalled),e.xp6(1),e.Q6J("ngIf",n.isReceiverPickupCalled),e.xp6(2),e.Q6J("ngIf",n.isReceiverPickupCalled),e.xp6(1),e.Q6J("ngIf",n.isReceiver),e.xp6(1),e.Q6J("ngIf",n.isCaller))},directives:[d.O5],styles:[".hang-up[_ngcontent-%COMP%]{transform:rotate(135deg)}.font-x-large[_ngcontent-%COMP%]{font-size:x-large}.video-main-container[_ngcontent-%COMP%]{height:100%;display:grid;grid-template-rows:80% 20%}.avatar[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{height:8rem}video[_ngcontent-%COMP%]{border-radius:12px;height:90%;width:90%}"]}),i})();var w=c(6518),_e=c(2950),pe=c(6986);const Ce=function(i){return{selected:i}},ve=function(i,o){return{online:i,offline:o}};function Me(i,o){if(1&i){const t=e.EpF();e.ynx(0),e.TgZ(1,"div",12),e.NdJ("click",function(){const a=e.CHM(t),s=a.index,r=a.$implicit;return e.oxw().changeCurrentChat(s,r)}),e.TgZ(2,"div",7),e._UZ(3,"img",13),e.qZA(),e.TgZ(4,"div",9)(5,"h3",3),e._uU(6),e.qZA()(),e._UZ(7,"span",14),e.qZA(),e.BQk()}if(2&i){const t=o.$implicit,n=o.index,a=e.oxw();e.xp6(1),e.Q6J("ngClass",e.VKq(4,Ce,n==a.selectedUser)),e.xp6(2),e.Q6J("src",a.sanitizer.bypassSecurityTrustResourceUrl(t.profileImage),e.LSH),e.xp6(3),e.Oqu(t.username),e.xp6(1),e.Q6J("ngClass",e.WLB(6,ve,!0===(null==t?null:t.isOnline),!1===(null==t?null:t.isOnline)))}}let Oe=(()=>{class i{constructor(t,n){this.sanitizer=t,this.authService=n,this.contacts=[],this.changeChat=new e.vpe,this.selectedUser=void 0}ngOnInit(){}changeCurrentChat(t,n){this.selectedUser=t,this.changeChat.emit(n)}logout(){this.authService.logoutUser().subscribe()}}return i.\u0275fac=function(t){return new(t||i)(e.Y36(D.H7),e.Y36(w.e))},i.\u0275cmp=e.Xpm({type:i,selectors:[["app-user-list"]],inputs:{contacts:"contacts",activeUser:"activeUser"},outputs:{changeChat:"changeChat"},decls:15,vars:3,consts:[[1,"main-container"],[1,"brand"],["src","assets/chat_icon.svg","alt","logo"],[1,"m-0"],[1,"contacts"],[4,"ngFor","ngForOf"],[1,"current-user"],[1,"avatar"],["alt","avatar",3,"src"],[1,"username"],[1,"btn","text-white","cursor-pointer",3,"click"],[1,"bi","bi-power"],[1,"contact",3,"ngClass","click"],[3,"src"],[1,"online-indicator",3,"ngClass"]],template:function(t,n){1&t&&(e.TgZ(0,"div",0)(1,"div",1),e._UZ(2,"img",2),e.TgZ(3,"h3",3),e._uU(4,"Chat's"),e.qZA()(),e.TgZ(5,"div",4),e.YNc(6,Me,8,9,"ng-container",5),e.qZA(),e.TgZ(7,"div",6)(8,"div",7),e._UZ(9,"img",8),e.qZA(),e.TgZ(10,"div",9)(11,"h2",3),e._uU(12),e.qZA()(),e.TgZ(13,"span",10),e.NdJ("click",function(){return n.logout()}),e._UZ(14,"i",11),e.qZA()()()),2&t&&(e.xp6(6),e.Q6J("ngForOf",n.contacts),e.xp6(3),e.Q6J("src",n.sanitizer.bypassSecurityTrustResourceUrl(n.activeUser.profileImage),e.LSH),e.xp6(3),e.Oqu(n.activeUser.username))},directives:[d.sg,d.mk],styles:[".main-container[_ngcontent-%COMP%]{display:grid;grid-template-rows:15% 70% 15%;overflow:hidden;background-color:#080420;height:100%}.main-container[_ngcontent-%COMP%]   .brand[_ngcontent-%COMP%]{display:flex;align-items:center;gap:1rem;justify-content:center}.main-container[_ngcontent-%COMP%]   .brand[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{height:2rem}.main-container[_ngcontent-%COMP%]   .brand[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{color:#fff;text-transform:uppercase}.main-container[_ngcontent-%COMP%]   .contacts[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;overflow:auto;gap:.8rem}.main-container[_ngcontent-%COMP%]   .contacts[_ngcontent-%COMP%]::-webkit-scrollbar{width:.2rem}.main-container[_ngcontent-%COMP%]   .contacts[_ngcontent-%COMP%]::-webkit-scrollbar-thumb{background-color:#ffffff39;width:.1rem;border-radius:1rem}.main-container[_ngcontent-%COMP%]   .contacts[_ngcontent-%COMP%]   .contact[_ngcontent-%COMP%]{background-color:#ffffff34;min-height:5rem;cursor:pointer;width:90%;border-radius:.2rem;padding:.4rem;display:flex;gap:1rem;align-items:center;transition:.5s ease-in-out}.main-container[_ngcontent-%COMP%]   .contacts[_ngcontent-%COMP%]   .contact[_ngcontent-%COMP%]   .avatar[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{height:3rem}.main-container[_ngcontent-%COMP%]   .contacts[_ngcontent-%COMP%]   .contact[_ngcontent-%COMP%]   .username[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{color:#fff}.main-container[_ngcontent-%COMP%]   .contacts[_ngcontent-%COMP%]   .selected[_ngcontent-%COMP%]{background-color:#9a86f3}.main-container[_ngcontent-%COMP%]   .current-user[_ngcontent-%COMP%]{background-color:#0d0d30;display:flex;justify-content:center;align-items:center;gap:2rem}.main-container[_ngcontent-%COMP%]   .current-user[_ngcontent-%COMP%]   .avatar[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{height:4rem;max-inline-size:100%}.main-container[_ngcontent-%COMP%]   .current-user[_ngcontent-%COMP%]   .username[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{color:#fff}@media screen and (min-width: 720px) and (max-width: 1080px){.main-container[_ngcontent-%COMP%]   .current-user[_ngcontent-%COMP%]{gap:.5rem}.main-container[_ngcontent-%COMP%]   .current-user[_ngcontent-%COMP%]   .username[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{font-size:1rem}}"]}),i})(),be=(()=>{class i{constructor(){}ngOnInit(){}}return i.\u0275fac=function(t){return new(t||i)},i.\u0275cmp=e.Xpm({type:i,selectors:[["app-welcome"]],inputs:{user:"user"},decls:8,vars:1,consts:[[1,"main-container"],["src","assets/chat_icon.svg"]],template:function(t,n){1&t&&(e.TgZ(0,"div",0),e._UZ(1,"img",1),e.TgZ(2,"h1"),e._uU(3," Welcome, "),e.TgZ(4,"span"),e._uU(5),e.qZA()(),e.TgZ(6,"h3"),e._uU(7,"Please select a chat to Start messaging."),e.qZA()()),2&t&&(e.xp6(5),e.hij("",null==n.user?null:n.user.username,"!"))},styles:[".main-container[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;color:#fff;flex-direction:column;height:100%}.main-container[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:5rem;height:5rem}.main-container[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{color:#4e0eff}"]}),i})();var L=c(2340),ye=c(520);let Pe=(()=>{class i{constructor(t){this.http=t}getChatHistory(t){return this.http.get(L.N.apiUrl+"/user/chatHistory/"+t)}sendMessageToUser(t){return this.http.post(L.N.apiUrl+"/user/sendMessageToUser",t).subscribe()}}return i.\u0275fac=function(t){return new(t||i)(e.LFG(ye.eN))},i.\u0275prov=e.Yz7({token:i,factory:i.\u0275fac,providedIn:"root"}),i})();var h=c(2382);const De=function(i,o){return{sended:i,recieved:o}};function xe(i,o){if(1&i&&(e.ynx(0),e.TgZ(1,"div")(2,"div",20)(3,"div",21)(4,"p",6),e._uU(5),e.qZA()()()(),e.BQk()),2&i){const t=o.$implicit,n=e.oxw(2);e.xp6(2),e.Q6J("ngClass",e.WLB(2,De,(null==t?null:t.fromUser)==(null==n.loginUser?null:n.loginUser._id),(null==t?null:t.fromUser)!==(null==n.loginUser?null:n.loginUser._id))),e.xp6(3),e.Oqu(null==t?null:t.message)}}function Te(i,o){if(1&i&&(e.ynx(0),e.YNc(1,xe,6,5,"ng-container",19),e.BQk()),2&i){const t=e.oxw();e.xp6(1),e.Q6J("ngForOf",t.messages)}}const we=function(i,o){return{online:i,offline:o}};let ke=(()=>{class i{constructor(t,n,a,s,r){this.sanitizer=t,this.socketService=n,this.authService=a,this.chatService=s,this.dialog=r,this.videoCallInit=new e.vpe,this.messages=[],this.newMessage=""}ngOnInit(){this.loginUser=this.authService.activeUserDetails(),this.receivedMessage()}ngOnChanges(){this.newMessage="",this.getChatHistory()}sendMessage(){var t,n,a;const s={fromUser:null===(t=this.loginUser)||void 0===t?void 0:t._id,toUser:null===(n=this.currentChatUser)||void 0===n?void 0:n._id,message:this.newMessage};if(""==(null===(a=this.newMessage)||void 0===a?void 0:a.trim()))return;this.messages.push(s),this.socketService.emit("sendMessage",s),this.chatService.sendMessageToUser(s),this.newMessage="";const r=document.getElementById("focus");null==r||r.focus()}receivedMessage(){this.socketService.listen("receiveMessage").subscribe(t=>{this.messages.push(t)})}getChatHistory(){this.chatService.getChatHistory(this.currentChatUser._id).subscribe(t=>{this.messages=t.status?t.data:[]})}startVideoCall(t,n){this.dialogRef=this.dialog.open(T,{width:"500px",height:"300px",disableClose:!0,data:{isCaller:!0,callerDetails:Object.assign({},n),isReceiver:!1,receiverDetails:Object.assign({},t)}}),this.socketService.emit("callInit",{fromUser:Object.assign({},n),toUser:Object.assign({},t)}),this.callendFromReciver(),this.dialogRef.afterClosed().subscribe(a=>{})}callendFromReciver(){this.socketService.listen("callendFromReceiverEmit").subscribe(t=>{t.callend&&this.dialogRef.close()})}}return i.\u0275fac=function(t){return new(t||i)(e.Y36(D.H7),e.Y36(x.$),e.Y36(w.e),e.Y36(Pe),e.Y36(P))},i.\u0275cmp=e.Xpm({type:i,selectors:[["app-chat-window"]],inputs:{currentChatUser:"currentChatUser"},outputs:{videoCallInit:"videoCallInit"},features:[e.TTD],decls:21,vars:9,consts:[[1,"chat-container"],[1,"chat-header"],[1,"user-details"],[1,"avatar"],["alt","profileAvatar",3,"src"],[1,"username"],[1,"m-0"],[1,"online-indicator",3,"ngClass"],[1,"d-flex","justify-content-center","align-items-center"],["id","video-chat-lobby",1,"btn","text-white",3,"click"],[1,"bi","bi-camera-video"],[1,"chat-messages",3,"scrollTop"],["scroll",""],[4,"ngIf"],[1,"message-input-container"],[1,"button-container"],[1,"input-container"],["autofocus","","id","focus","type","text","name","newMessage","placeholder","type your message here",3,"ngModel","ngModelChange"],["type","submit",3,"click"],[4,"ngFor","ngForOf"],[1,"message",3,"ngClass"],[1,"content"]],template:function(t,n){if(1&t&&(e.TgZ(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3),e._UZ(4,"img",4),e.qZA(),e.TgZ(5,"div",5)(6,"h3",6),e._uU(7),e.qZA(),e._UZ(8,"span",7),e.qZA()(),e.TgZ(9,"div",8)(10,"span",9),e.NdJ("click",function(){return n.startVideoCall(n.currentChatUser,n.loginUser)}),e._UZ(11,"i",10),e.qZA()()(),e.TgZ(12,"div",11,12),e.YNc(14,Te,2,1,"ng-container",13),e.qZA(),e.TgZ(15,"div",14),e._UZ(16,"div",15),e.TgZ(17,"form",16)(18,"input",17),e.NdJ("ngModelChange",function(s){return n.newMessage=s}),e.qZA(),e.TgZ(19,"button",18),e.NdJ("click",function(){return n.sendMessage()}),e._uU(20,"send"),e.qZA()()()()),2&t){const a=e.MAs(13);e.xp6(4),e.Q6J("src",n.sanitizer.bypassSecurityTrustResourceUrl(n.currentChatUser.profileImage),e.LSH),e.xp6(3),e.Oqu(n.currentChatUser.username),e.xp6(1),e.Q6J("ngClass",e.WLB(6,we,!0===(null==n.currentChatUser?null:n.currentChatUser.isOnline),!1===(null==n.currentChatUser?null:n.currentChatUser.isOnline))),e.xp6(4),e.Q6J("scrollTop",a.scrollHeight),e.xp6(2),e.Q6J("ngIf",0!=n.messages.length),e.xp6(4),e.Q6J("ngModel",n.newMessage)}},directives:[d.mk,d.O5,d.sg,h._Y,h.JL,h.F,h.Fj,h.JJ,h.On],styles:[".chat-container[_ngcontent-%COMP%]{display:grid;grid-template-rows:10% 80% 10%;grid-gap:.1rem;gap:.1rem;overflow:hidden;height:500px}@media screen and (min-width: 720px) and (max-width: 1080px){.chat-container[_ngcontent-%COMP%]{grid-template-rows:15% 70% 15%}}.chat-container[_ngcontent-%COMP%]   .chat-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;padding:0 2rem}.chat-container[_ngcontent-%COMP%]   .chat-header[_ngcontent-%COMP%]   .user-details[_ngcontent-%COMP%]{display:flex;align-items:center;gap:1rem}.chat-container[_ngcontent-%COMP%]   .chat-header[_ngcontent-%COMP%]   .user-details[_ngcontent-%COMP%]   .avatar[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{height:3rem}.chat-container[_ngcontent-%COMP%]   .chat-header[_ngcontent-%COMP%]   .user-details[_ngcontent-%COMP%]   .username[_ngcontent-%COMP%]{display:flex;align-items:center}.chat-container[_ngcontent-%COMP%]   .chat-header[_ngcontent-%COMP%]   .user-details[_ngcontent-%COMP%]   .username[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{color:#fff;margin-right:5px}.chat-container[_ngcontent-%COMP%]   .chat-messages[_ngcontent-%COMP%]{padding:1rem 2rem;display:flex;flex-direction:column;gap:1rem;overflow:auto}.chat-container[_ngcontent-%COMP%]   .chat-messages[_ngcontent-%COMP%]::-webkit-scrollbar{width:.2rem}.chat-container[_ngcontent-%COMP%]   .chat-messages[_ngcontent-%COMP%]::-webkit-scrollbar-thumb{background-color:#ffffff39;width:.1rem;border-radius:1rem}.chat-container[_ngcontent-%COMP%]   .chat-messages[_ngcontent-%COMP%]   .message[_ngcontent-%COMP%]{display:flex;align-items:center}.chat-container[_ngcontent-%COMP%]   .chat-messages[_ngcontent-%COMP%]   .message[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]{max-width:40%;overflow-wrap:break-word;padding:1rem;font-size:1.1rem;border-radius:1rem;color:#d1d1d1}@media screen and (min-width: 720px) and (max-width: 1080px){.chat-container[_ngcontent-%COMP%]   .chat-messages[_ngcontent-%COMP%]   .message[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]{max-width:70%}}.chat-container[_ngcontent-%COMP%]   .chat-messages[_ngcontent-%COMP%]   .sended[_ngcontent-%COMP%]{justify-content:flex-end}.chat-container[_ngcontent-%COMP%]   .chat-messages[_ngcontent-%COMP%]   .sended[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]{background-color:#4f04ff21}.chat-container[_ngcontent-%COMP%]   .chat-messages[_ngcontent-%COMP%]   .recieved[_ngcontent-%COMP%]{justify-content:flex-start}.chat-container[_ngcontent-%COMP%]   .chat-messages[_ngcontent-%COMP%]   .recieved[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]{background-color:#9900ff20}.message-input-container[_ngcontent-%COMP%]{display:grid;align-items:center;grid-template-columns:5% 95%;background-color:#080420;padding:0 2rem}@media screen and (min-width: 720px) and (max-width: 1080px){.message-input-container[_ngcontent-%COMP%]{padding:0 1rem;gap:1rem}}.message-input-container[_ngcontent-%COMP%]   .button-container[_ngcontent-%COMP%]{display:flex;align-items:center;color:#fff;gap:1rem}.message-input-container[_ngcontent-%COMP%]   .button-container[_ngcontent-%COMP%]   .emoji[_ngcontent-%COMP%]{position:relative}.message-input-container[_ngcontent-%COMP%]   .button-container[_ngcontent-%COMP%]   .emoji[_ngcontent-%COMP%]   svg[_ngcontent-%COMP%]{font-size:1.5rem;color:#ffff00c8;cursor:pointer}.message-input-container[_ngcontent-%COMP%]   .button-container[_ngcontent-%COMP%]   .emoji[_ngcontent-%COMP%]   .emoji-picker-react[_ngcontent-%COMP%]{position:absolute;top:-350px;background-color:#080420;box-shadow:0 5px 10px #9a86f3;border-color:#9a86f3}.message-input-container[_ngcontent-%COMP%]   .button-container[_ngcontent-%COMP%]   .emoji[_ngcontent-%COMP%]   .emoji-picker-react[_ngcontent-%COMP%]   .emoji-scroll-wrapper[_ngcontent-%COMP%]::-webkit-scrollbar{background-color:#080420;width:5px}.message-input-container[_ngcontent-%COMP%]   .button-container[_ngcontent-%COMP%]   .emoji[_ngcontent-%COMP%]   .emoji-picker-react[_ngcontent-%COMP%]   .emoji-scroll-wrapper[_ngcontent-%COMP%]::-webkit-scrollbar-thumb{background-color:#9a86f3}.message-input-container[_ngcontent-%COMP%]   .button-container[_ngcontent-%COMP%]   .emoji[_ngcontent-%COMP%]   .emoji-picker-react[_ngcontent-%COMP%]   .emoji-categories[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{filter:contrast(0)}.message-input-container[_ngcontent-%COMP%]   .button-container[_ngcontent-%COMP%]   .emoji[_ngcontent-%COMP%]   .emoji-picker-react[_ngcontent-%COMP%]   .emoji-search[_ngcontent-%COMP%]{background-color:transparent;border-color:#9a86f3}.message-input-container[_ngcontent-%COMP%]   .button-container[_ngcontent-%COMP%]   .emoji[_ngcontent-%COMP%]   .emoji-picker-react[_ngcontent-%COMP%]   .emoji-group[_ngcontent-%COMP%]:before{background-color:#080420}.message-input-container[_ngcontent-%COMP%]   .input-container[_ngcontent-%COMP%]{width:100%;border-radius:2rem;display:flex;align-items:center;gap:2rem;background-color:#ffffff34;height:50%}.message-input-container[_ngcontent-%COMP%]   .input-container[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{width:90%;height:60%;background-color:transparent;color:#fff;border:none;padding-left:1rem;font-size:1.2rem}.message-input-container[_ngcontent-%COMP%]   .input-container[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]::selection{background-color:#9a86f3}.message-input-container[_ngcontent-%COMP%]   .input-container[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]:focus{outline:none}.message-input-container[_ngcontent-%COMP%]   .input-container[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{padding:.3rem 2rem;border-radius:2rem;display:flex;justify-content:center;align-items:center;background-color:#9a86f3;border:none;height:100%}@media screen and (min-width: 720px) and (max-width: 1080px){.message-input-container[_ngcontent-%COMP%]   .input-container[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{padding:.3rem 1rem}.message-input-container[_ngcontent-%COMP%]   .input-container[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]   svg[_ngcontent-%COMP%]{font-size:1rem}}.message-input-container[_ngcontent-%COMP%]   .input-container[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]   svg[_ngcontent-%COMP%]{font-size:2rem;color:#fff}"]}),i})();const Ae=["peerRef"];function Re(i,o){if(1&i&&(e.ynx(0),e._UZ(1,"app-welcome",5),e.BQk()),2&i){const t=e.oxw();e.xp6(1),e.Q6J("user",t.activeUser)}}function Ue(i,o){if(1&i&&e._UZ(0,"app-chat-window",6),2&i){const t=e.oxw();e.Q6J("currentChatUser",t.currentChatUser)}}let Se=(()=>{class i{constructor(t,n,a,s,r){this.authService=t,this.userService=n,this.socketService=a,this.pushNotificationService=s,this.dialog=r,this.isCaller=!0,this.contacts=[],this.iceServers={iceServers:[{urls:"stun:stun.services.mozilla.com"},{urls:"stun:stun.l.google.com:19302"}]}}ngOnInit(){window.addEventListener("visibilitychange",()=>{"visible"===document.visibilityState?(console.log("visible"),this.userBackToTheWindow()):"hidden"===document.visibilityState&&(console.log("hidden"),this.userLeftTheWindow())}),this.activeUser=this.authService.activeUserDetails(),this.userConnected(),this.userDisconnected(),this.activeUser&&(this.pushNotificationService.registerPushNotificationSubscription(),this.listenAnyOneIsCalling()),this.userService.getAllUserList().subscribe(t=>{t.status&&(this.contacts=t.data)})}listenAnyOneIsCalling(){this.socketService.listen("anyOneCalling").subscribe(t=>{this.callEndByCaller(),this.dialogRef=this.dialog.open(T,{width:"500px",height:"300px",disableClose:!0,data:{isCaller:!1,callerDetails:Object.assign({},t.callerDetails),isReceiver:!0,receiverDetails:Object.assign({},t.receiverDetails)}})})}callEndByCaller(){this.socketService.listen("callendFromCallerEmit").subscribe(t=>{t.callend&&this.dialogRef.close()})}handleChatChange(t){this.currentChatUser=t}userBackToTheWindow(){this.socketService.emit("userConnect",Object.assign(Object.assign({},this.activeUser),{isOnline:!0}))}userLeftTheWindow(){this.socketService.emit("userDisconnect",Object.assign(Object.assign({},this.activeUser),{isOnline:!1})),console.log("called")}userConnected(){this.socketService.listen("userConnected").subscribe(t=>{if(0!=this.contacts.length&&0!=Object.values(t).length)for(let n of this.contacts)n._id==t._id&&(n.isOnline=!0)})}userDisconnected(){this.socketService.listen("userDisconnected").subscribe(t=>{if(0!=this.contacts.length&&0!=Object.values(t).length)for(let n of this.contacts)n._id==t._id&&(n.isOnline=!1)})}ngAfterViewInit(){}}return i.\u0275fac=function(t){return new(t||i)(e.Y36(w.e),e.Y36(_e.K),e.Y36(x.$),e.Y36(pe.K),e.Y36(P))},i.\u0275cmp=e.Xpm({type:i,selectors:[["app-home"]],viewQuery:function(t,n){if(1&t&&(e.Gf(T,5),e.Gf(Ae,5)),2&t){let a;e.iGM(a=e.CRH())&&(n.videoComponent=a.first),e.iGM(a=e.CRH())&&(n.peerVideo=a.first)}},decls:6,vars:4,consts:[[1,"main-container"],[1,"child-container"],[3,"contacts","activeUser","changeChat"],[4,"ngIf","ngIfElse"],["chatwindow",""],[3,"user"],[3,"currentChatUser"]],template:function(t,n){if(1&t&&(e.TgZ(0,"div",0)(1,"div",1)(2,"app-user-list",2),e.NdJ("changeChat",function(s){return n.handleChatChange(s)}),e.qZA(),e.YNc(3,Re,2,1,"ng-container",3),e.YNc(4,Ue,1,1,"ng-template",null,4,e.W1O),e.qZA()()),2&t){const a=e.MAs(5);e.xp6(2),e.Q6J("contacts",n.contacts)("activeUser",n.activeUser),e.xp6(1),e.Q6J("ngIf",void 0===n.currentChatUser)("ngIfElse",a)}},directives:[Oe,d.O5,be,ke],styles:[".main-container[_ngcontent-%COMP%]{height:100vh;width:100vw;display:flex;flex-direction:column;justify-content:center;gap:1rem;align-items:center;background-color:#131324}.main-container[_ngcontent-%COMP%]   .child-container[_ngcontent-%COMP%]{height:85vh;width:95vw;background-color:#00000076;display:grid;grid-template-columns:25% 75%}@media screen and (min-width: 720px) and (max-width: 1080px){.main-container[_ngcontent-%COMP%]   .child-container[_ngcontent-%COMP%]{grid-template-columns:35% 65%}}@media screen and (max-width: 719px){.main-container[_ngcontent-%COMP%]   .child-container[_ngcontent-%COMP%]{grid-template-columns:100% 100%}}"]}),i})(),Ze=(()=>{class i{}return i.\u0275fac=function(t){return new(t||i)},i.\u0275mod=e.oAB({type:i}),i.\u0275inj=e.cJS({imports:[[d.ez]]}),i})(),Ie=(()=>{class i{}return i.\u0275fac=function(t){return new(t||i)},i.\u0275mod=e.oAB({type:i}),i.\u0275inj=e.cJS({imports:[[d.ez]]}),i})(),V=(()=>{class i{}return i.\u0275fac=function(t){return new(t||i)},i.\u0275mod=e.oAB({type:i}),i.\u0275inj=e.cJS({imports:[[d.ez,B]]}),i})(),Fe=(()=>{class i{}return i.\u0275fac=function(t){return new(t||i)},i.\u0275mod=e.oAB({type:i}),i.\u0275inj=e.cJS({imports:[[d.ez,h.u5,V]]}),i})();const je=[{path:"",component:Se}];let Ee=(()=>{class i{}return i.\u0275fac=function(t){return new(t||i)},i.\u0275mod=e.oAB({type:i}),i.\u0275inj=e.cJS({imports:[[d.ez,Ie,Ze,Fe,V,R.Bz.forChild(je),B],R.Bz]}),i})()}}]);